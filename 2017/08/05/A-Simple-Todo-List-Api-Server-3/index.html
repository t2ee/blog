<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Tutorial Series (1): A Simple Todo List Api Server (3) · @t2ee</title><meta name="description" content="Tutorial Series (1): A Simple Todo List Api Server (3) - Qiaosen Huang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="https://t2ee.org/favicon-192.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.t2ee.org/atom.xml" title="@t2ee"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="https://t2ee.org/img/logos/t2ee.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="https://t2ee.org" target="_blank" class="nav-list-link">@T2EE</a></li><li class="nav-list-item"><a href="https://t2ee.io" target="_blank" class="nav-list-link">FORUM</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Tutorial Series (1): A Simple Todo List Api Server (3)</h1><div class="post-info">Aug 5, 2017<a class="tag-link" href="/tags/A-Simple-Todo-List-Api-Server/">#A Simple Todo List Api Server</a>, <a class="tag-link" href="/tags/tutorials/">#tutorials</a></div><div class="post-content"><h1 id="Advanced-Content"><a href="#Advanced-Content" class="headerlink" title="Advanced Content"></a>Advanced Content</h1><p>If you missed the first two articles, you are strongly advised to read them first. <a href="/2017/08/04/A-Simple-Todo-List-Api-Server-1">Chapter-1</a> and <a href="/2017/08/04/A-Simple-Todo-List-Api-Server-2">Chapter-2</a></p>
<p>In this chapter, we will be implementing error handling and input validation.</p>
<h1 id="Validate-Input"><a href="#Validate-Input" class="headerlink" title="Validate Input"></a>Validate Input</h1><p>Let’s first import the necessary components.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span>  &#123;</div><div class="line">    Valid,</div><div class="line">    Min,</div><div class="line">    Max,</div><div class="line">    NotNull,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/validation'</span>;</div></pre></td></tr></table></figure>
<p>We will be implementing a TodoItem class which specify how we should validate inputs.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> TodoItem &#123;</div><div class="line">    id: <span class="built_in">number</span>;</div><div class="line"></div><div class="line">    <span class="meta">@NotNull</span></div><div class="line">    <span class="meta">@Min</span>(<span class="number">1</span>)</div><div class="line">    <span class="meta">@Max</span>(<span class="number">10</span>)</div><div class="line">    name: <span class="built_in">string</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we have a form that takes two fields, <code>id</code> and <code>name</code>. <code>id</code> can be null, and <code>name</code> should be a string with <code>1-10</code> characters.</p>
<p>To make it automatically validate input body, all we have to do is two modifications on method declarations, following is an example on <code>postItem</code>.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> postItem(<span class="meta">@Valid</span> <span class="meta">@Body</span> body: TodoItem, <span class="meta">@PathParam</span>(<span class="string">'id'</span>) id)</div></pre></td></tr></table></figure>
<p>First, we need to add <code>@valid</code> decorator to tell our validator that this parameter should be validated, and change its declaration type to the class we implemented above. Thus, all those rules will be validated against request body.</p>
<p>Apply the same to <code>putItem</code>. Now we have all our input validated;</p>
<h1 id="Error-Handling"><a href="#Error-Handling" class="headerlink" title="Error Handling"></a>Error Handling</h1><p>The one problem with this api service is that it is not really <code>RESTful</code>, all errors are not correctly returned to the user.</p>
<p>To achive so, we will implement a configuration class to implement error handling.</p>
<p>First, let’s create a file <code>config.ts</code>, and import it in <code>index.ts</code>, something like <code>import &#39;./config&#39;</code>. This makes sure configurations are applied.</p>
<p>Now, import all components that we are gonna use.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    Configuration,</div><div class="line">    Bean,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/core'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    NotFoundHandler,</div><div class="line">    ErrorHandler,</div><div class="line">    Request,</div><div class="line">    Response,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/vader'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    ValidationError,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/validation'</span>;</div></pre></td></tr></table></figure>
<p>To provide autowirable objects globally, we need to have a configuration class.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">class</span> Config &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Let’s first handle <code>404</code> properly.</p>
<p>Add following method to class <code>Config</code>.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span>(<span class="string">'NotFoundHandler'</span>)</div><div class="line">notFoundHandler(): NotFoundHandler &#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="keyword">async</span> handle(req: Request, data: <span class="built_in">void</span>): <span class="built_in">Promise</span>&lt;Response&gt; &#123;</div><div class="line">            <span class="keyword">const</span> res = <span class="keyword">new</span> Response();</div><div class="line">            res.body = &#123;</div><div class="line">                error: <span class="string">'not found'</span>,</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> res;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>@Bean</code> means this is injected as an instance not a class. Passing a string to it, makes us/<code>vader</code> access it by name (since <code>NotFoundHandler</code> is an <code>interface</code>, which is psuedo, that is not generated in js).</p>
<p>In the handler, we make it returnning json response, this makes it easier to handle on client side.</p>
<p>Notice after we added validation, the server responds a <code>internal error</code> to the client if wrong data were requested. It is because there is no handler for this type of error.</p>
<p>Add following to <code>Config</code>.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span>(<span class="string">'ErrorHandler'</span>)</div><div class="line">errorHandler(): ErrorHandler &#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="keyword">async</span> handle(req: Request, e: <span class="built_in">Error</span>): <span class="built_in">Promise</span>&lt;Response&gt; &#123;</div><div class="line">            <span class="keyword">let</span> error = <span class="string">'internal error'</span>;</div><div class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ValidationError) &#123;</div><div class="line">                error = <span class="string">'request error'</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">const</span> res = <span class="keyword">new</span> Response();</div><div class="line">            res.body = &#123;</div><div class="line">                error,</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> res;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Put-it-together"><a href="#Put-it-together" class="headerlink" title="Put it together"></a>Put it together</h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    Configuration,</div><div class="line">    Bean,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/core'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    NotFoundHandler,</div><div class="line">    ErrorHandler,</div><div class="line">    Request,</div><div class="line">    Response,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/vader'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    ValidationError,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/validation'</span>;</div><div class="line"></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">class</span> Config &#123;</div><div class="line">    <span class="meta">@Bean</span>(<span class="string">'NotFoundHandler'</span>)</div><div class="line">    notFoundHandler(): NotFoundHandler &#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="keyword">async</span> handle(req: Request, data: <span class="built_in">void</span>): <span class="built_in">Promise</span>&lt;Response&gt; &#123;</div><div class="line">                <span class="keyword">const</span> res = <span class="keyword">new</span> Response();</div><div class="line">                res.body = &#123;</div><div class="line">                    error: <span class="string">'not found'</span>,</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> res;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span>(<span class="string">'ErrorHandler'</span>)</div><div class="line">    errorHandler(): ErrorHandler &#123;</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="keyword">async</span> handle(req: Request, e: <span class="built_in">Error</span>): <span class="built_in">Promise</span>&lt;Response&gt; &#123;</div><div class="line">                <span class="keyword">let</span> error = <span class="string">'internal error'</span>;</div><div class="line">                <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ValidationError) &#123;</div><div class="line">                    error = <span class="string">'request error'</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">const</span> res = <span class="keyword">new</span> Response();</div><div class="line">                res.body = &#123;</div><div class="line">                    error,</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> res;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Lastly"><a href="#Lastly" class="headerlink" title="Lastly"></a>Lastly</h1><p>This is the end of this project. Again, you can access all source codes for each chapter at <a href="https://github.com/t2ee/tutorial-series-1" target="_blank" rel="external">https://github.com/t2ee/tutorial-series-1</a>.</p>
<p>I hope you know a bit more of <code>@t2ee</code> components by now. In the next series, we will be learning how to customize them.</p>
<p>See you soon!</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/08/04/A-Simple-Todo-List-Api-Server-2/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 't2ee';
var disqus_identifier = '2017/08/05/A-Simple-Todo-List-Api-Server-3/';
var disqus_title = 'Tutorial Series (1): A Simple Todo List Api Server (3)';
var disqus_url = 'https://blog.t2ee.org/2017/08/05/A-Simple-Todo-List-Api-Server-3/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//t2ee.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="https://blog.t2ee.org">Qiaosen Huang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-104099468-2",'auto');ga('send','pageview');</script></body></html>