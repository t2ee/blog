<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Tutorial Series (1): A Simple Todo List Api Server (1) · @t2ee</title><meta name="description" content="Tutorial Series (1): A Simple Todo List Api Server (1) - Qiaosen Huang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="https://t2ee.org/favicon-192.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.t2ee.org/atom.xml" title="@t2ee"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="https://t2ee.org/img/logos/t2ee.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="https://t2ee.org" target="_blank" class="nav-list-link">@T2EE</a></li><li class="nav-list-item"><a href="https://t2ee.io" target="_blank" class="nav-list-link">FORUM</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Tutorial Series (1): A Simple Todo List Api Server (1)</h1><div class="post-info">Aug 4, 2017<a class="tag-link" href="/tags/A-Simple-Todo-List-Api-Server/">#A Simple Todo List Api Server</a>, <a class="tag-link" href="/tags/tutorials/">#tutorials</a></div><div class="post-content"><h1 id="First-of-all"><a href="#First-of-all" class="headerlink" title="First of all"></a>First of all</h1><p>This is the first project of the <a href="/tags/tutorials">Tutorial Serires</a>.</p>
<p>For this project, we will be building a simple TODO list api server, with CRUD abilities.<br>You can download the source code at <a href="https://github.com/t2ee/tutorial-series-1" target="_blank" rel="external">https://github.com/t2ee/tutorial-series-1</a></p>
<h1 id="Preperation"><a href="#Preperation" class="headerlink" title="Preperation"></a>Preperation</h1><p>To get our hands sweaty, first we need to setup some basic dependencies and environment.</p>
<p><code>npm i typescript reflect-metadata @t2ee/core @t2ee/sl4js @t2ee/validation @t2ee/vdaer koa@2</code></p>
<p>These are all the packages we are gonna be using for this tutorial. also don’t forget to create a <code>tsconfig.json</code>, with <code>experimentalDecorators</code> and <code>emitDecoratorMetadata</code> enabled.</p>
<p>If you do not already have one or not familar with <code>typescript</code> yet, following is an good start.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"compilerOptions"</span>: &#123;</div><div class="line">        <span class="attr">"module"</span>: <span class="string">"commonjs"</span>,</div><div class="line">        <span class="attr">"outDir"</span>: <span class="string">"./dist"</span>,</div><div class="line">        <span class="attr">"target"</span>: <span class="string">"ES6"</span>,</div><div class="line">        <span class="attr">"experimentalDecorators"</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">"emitDecoratorMetadata"</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">"declaration"</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">"sourceMap"</span>: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"compileOnSave"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"include"</span>: [</div><div class="line">        <span class="string">"src/**/*.ts"</span></div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Objectives"><a href="#Objectives" class="headerlink" title="Objectives"></a>Objectives</h1><p>For the first part of this tutorial, we are building two routes first. <code>GET /todo</code> and <code>GET /todo/:id</code>. </p>
<p>The first one will return the list of all todo items, and the second returns an item that matches the id.</p>
<h1 id="First-Controller"><a href="#First-Controller" class="headerlink" title="First Controller"></a>First Controller</h1><p>First, let’s prepare <code>logger.yaml</code>, which will be read by <code>@t2ee/sl4js</code> to configure loggers and formats.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="attr">default:</span> <span class="string">console</span> </div><div class="line"><span class="attr">level:</span> <span class="string">LogLevel.DEBUG</span></div><div class="line"><span class="attr">appenders:</span></div><div class="line"><span class="attr">  - name:</span> <span class="string">console</span></div><div class="line"><span class="attr">    appender:</span> <span class="string">console</span></div><div class="line"><span class="attr">    pattern:</span> <span class="string">'%d&#123;YYYY-MM-DD HH:mm:ss.SSS&#125; %-7c&#123;[%l]&#125; %10n %5p - %2w  %M'</span></div><div class="line"><span class="attr">    level:</span> <span class="string">LogLevel.DEBUG</span></div></pre></td></tr></table></figure>
<p>To move on with this tutorial, we will not be discussing the details of loggin configurations here today, other tutorials will be covering it.</p>
<p>Now, let’s code our controller, which will be responsible how requests are handled.</p>
<p>First import all components we will be using.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    GET,</div><div class="line">    Path,</div><div class="line">    Response,</div><div class="line">    PathParam,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/vader'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    Component,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/core'</span>;</div></pre></td></tr></table></figure>
<p><code>@GET</code> and <code>@Path</code> define routes. Response is the object you will be returning at the end of request. <code>@PathParam</code> is used to acquire parameters in path. <code>@Component</code> needs to be added to class to trigger bindings, otherwise, none of the above would work.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">'/todo'</span>)</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Controller &#123;</div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="meta">@Path</span>(<span class="string">'/'</span>)</div><div class="line">    <span class="keyword">async</span> getList(): <span class="built_in">Promise</span>&lt;Response&gt; &#123;</div><div class="line">        <span class="keyword">const</span> response = <span class="keyword">new</span> Response();</div><div class="line">        response.body = LIST;</div><div class="line">        <span class="keyword">return</span> response;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>let’s also define a local variable to store todo items in memory.<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> LIST = [&#123;</div><div class="line">    id: <span class="number">0</span>,</div><div class="line">    name: <span class="string">'a'</span>,</div><div class="line">&#125;, &#123;</div><div class="line">    id: <span class="number">1</span>,</div><div class="line">    name: <span class="string">'b'</span>,</div><div class="line">&#125;];</div></pre></td></tr></table></figure></p>
<p>So now we have our class and first route. </p>
<p>In order to run the controller, we also need to have an entry file to register our controller into the router, see <a href="#index-ts">index.ts</a></p>
<p>Now run <code>tsc -p tsconfig.json &amp;&amp; node dist</code>, this will compile all the source codes and start the server.</p>
<p>You should be able to see something like below</p>
<p><img src="1.png" alt=""></p>
<p>Now navigate your brower to <code>http://localhost:8080/todo</code>, you should be able to all the todo items.</p>
<h1 id="Add-Another-Route"><a href="#Add-Another-Route" class="headerlink" title="Add Another Route"></a>Add Another Route</h1><p>Now we want to access single todo items by id, <code>@PathParam</code> comes in for us to get id from path.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@GET</div><div class="line">@Path(&apos;/:id&apos;)</div><div class="line">async getItem(@PathParam(&apos;id&apos;) id) &#123;</div><div class="line">    id = parseInt(id);</div><div class="line">    const item = LIST.find(todo =&gt; todo.id === id);</div><div class="line">    if (item) &#123;</div><div class="line">        const response = new Response();</div><div class="line">        response.body = item;</div><div class="line">        return response;    </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This will be able to handle path like <code>/todo/1</code>.</p>
<p>If you want to take id from query, you can change the first route to following (don’t forget to import <code>QueryParam</code> form <code>@t2ee/vader</code>).</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET</span></div><div class="line"><span class="meta">@Path</span>(<span class="string">'/'</span>)</div><div class="line"><span class="keyword">async</span> getList(<span class="meta">@QueryParam</span>(<span class="string">'id'</span>) id): <span class="built_in">Promise</span>&lt;Response&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (id) &#123;</div><div class="line">        id = <span class="built_in">parseInt</span>(id);</div><div class="line">        <span class="keyword">const</span> item = LIST.find(<span class="function"><span class="params">todo</span> =&gt;</span> todo.id === id);</div><div class="line">        <span class="keyword">if</span> (item) &#123;</div><div class="line">            <span class="keyword">const</span> response = <span class="keyword">new</span> Response();</div><div class="line">            response.body = item;</div><div class="line">            <span class="keyword">return</span> response;    </div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">const</span> response = <span class="keyword">new</span> Response();</div><div class="line">        response.body = LIST;</div><div class="line">        <span class="keyword">return</span> response;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="All-together"><a href="#All-together" class="headerlink" title="All together"></a>All together</h1><h2 id="index-ts"><a href="#index-ts" class="headerlink" title="index.ts"></a>index.ts</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">'reflect-metadata'</span>;</div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">'path'</span>;</div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    ConfigurationStore,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/core'</span>;</div><div class="line">ConfigurationStore.loadFile(path.resolve(__dirname, <span class="string">'../logger'</span>));</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    Router,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/vader'</span>;</div><div class="line"><span class="keyword">import</span> Controller <span class="keyword">from</span> <span class="string">'./controller'</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">const</span> router = Router.newInstance();</div><div class="line">router.use(Controller);</div><div class="line"></div><div class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</div><div class="line">app.use(router.routes());</div><div class="line">app.listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure>
<h2 id="logger-yaml"><a href="#logger-yaml" class="headerlink" title="logger.yaml"></a>logger.yaml</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="attr">default:</span> <span class="string">console</span> </div><div class="line"><span class="attr">level:</span> <span class="string">LogLevel.DEBUG</span></div><div class="line"><span class="attr">appenders:</span></div><div class="line"><span class="attr">  - name:</span> <span class="string">console</span></div><div class="line"><span class="attr">    appender:</span> <span class="string">console</span></div><div class="line"><span class="attr">    pattern:</span> <span class="string">'%d&#123;YYYY-MM-DD HH:mm:ss.SSS&#125; %-7c&#123;[%l]&#125; %10n %5p - %2w  %M'</span></div><div class="line"><span class="attr">    level:</span> <span class="string">LogLevel.DEBUG</span></div></pre></td></tr></table></figure>
<h2 id="controller-ts"><a href="#controller-ts" class="headerlink" title="controller.ts"></a>controller.ts</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    GET,</div><div class="line">    Path,</div><div class="line">    Response,</div><div class="line">    PathParam,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/vader'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">    Component,</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'@t2ee/core'</span>;</div><div class="line"></div><div class="line"><span class="keyword">let</span> LIST = [&#123;</div><div class="line">    id: <span class="number">0</span>,</div><div class="line">    name: <span class="string">'a'</span>,</div><div class="line">&#125;, &#123;</div><div class="line">    id: <span class="number">1</span>,</div><div class="line">    name: <span class="string">'b'</span>,</div><div class="line">&#125;];</div><div class="line"></div><div class="line"><span class="meta">@Path</span>(<span class="string">'/todo'</span>)</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Controller &#123;</div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="meta">@Path</span>(<span class="string">'/'</span>)</div><div class="line">    <span class="keyword">async</span> getList(<span class="meta">@QueryParam</span>(<span class="string">'id'</span>) id): <span class="built_in">Promise</span>&lt;Response&gt; &#123;</div><div class="line">        <span class="keyword">if</span> (id) &#123;</div><div class="line">            id = <span class="built_in">parseInt</span>(id);</div><div class="line">            <span class="keyword">const</span> item = LIST.find(<span class="function"><span class="params">todo</span> =&gt;</span> todo.id === id);</div><div class="line">            <span class="keyword">if</span> (item) &#123;</div><div class="line">                <span class="keyword">const</span> response = <span class="keyword">new</span> Response();</div><div class="line">                response.body = item;</div><div class="line">                <span class="keyword">return</span> response;    </div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">const</span> response = <span class="keyword">new</span> Response();</div><div class="line">            response.body = LIST;</div><div class="line">            <span class="keyword">return</span> response;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="meta">@Path</span>(<span class="string">'/:id'</span>)</div><div class="line">    <span class="keyword">async</span> getItem(<span class="meta">@PathParam</span>(<span class="string">'id'</span>) id) &#123;</div><div class="line">        id = <span class="built_in">parseInt</span>(id);</div><div class="line">        <span class="keyword">const</span> item = LIST.find(<span class="function"><span class="params">todo</span> =&gt;</span> todo.id === id);</div><div class="line">        <span class="keyword">if</span> (item) &#123;</div><div class="line">            <span class="keyword">const</span> response = <span class="keyword">new</span> Response();</div><div class="line">            response.body = item;</div><div class="line">            <span class="keyword">return</span> response;    </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Last-but-not-the-least"><a href="#Last-but-not-the-least" class="headerlink" title="Last but not the least"></a>Last but not the least</h1><p>This should conclude our first part of our first tutorial. In the next part, we will be finishing it up, adding <strong>create</strong>, <strong>update</strong> and <strong>delete</strong> routes.</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/08/04/A-Simple-Todo-List-Api-Server-2/" class="prev">上一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 't2ee';
var disqus_identifier = '2017/08/04/A-Simple-Todo-List-Api-Server-1/';
var disqus_title = 'Tutorial Series (1): A Simple Todo List Api Server (1)';
var disqus_url = 'https://blog.t2ee.org/2017/08/04/A-Simple-Todo-List-Api-Server-1/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//t2ee.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2017 <a href="https://blog.t2ee.org">Qiaosen Huang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-104099468-2",'auto');ga('send','pageview');</script></body></html>